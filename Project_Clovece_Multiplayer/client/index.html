<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/client/css/bootstrap.css">
    <link rel="stylesheet" href="/client/css/bootstrap.min.css">
    <link rel="stylesheet" href="/client/css/style.css">
    <title>Document</title>
    <link rel="stylesheet" href="login.css">
</head>
<body>
  <div id="numerofp">

  </div>
  <div id="content">
    <div id="page-preloader" class="preloader">
        <div class="loader">

        </div>
    </div>
     <div id="login">
        <div id="name">
        <form action="newPlayerLogin()">
         <label for="">Your Name</label>
         <input id="myName" class = "inputField" type="text" placeholder="Type in your username">
         <br>
         <label for="">Game Name</label>
         <input id="myGame" class = "inputField" type="text" placeholder="Type Name of the Game">
         <br>
         <button href="index.html" class="btn btn-lg btn-dark" onclick="newPlayerLogin()">Start Game</button>
         </form>
         </div>
     </div>
  </div>


            <script src="/client/script/preloader.js"></script>

            <script src="/client/script/gameLogic.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
            <script type="text/javascript">
              var myID = Math.random();
              var myName = "";
              var myGame = "";
              var iamPlayer = 1;
              var numberOfPlayers = 1;
              var playersInGame = [];
              var activeGames = [];
              var loginMenu = 1;

              //WEB SOCKETS

              var socket = io();

              var newPlayerLogin = function(){    //Function called in Login process
                var name = document.getElementById('myName').value;
                var game = document.getElementById('myGame').value;
                myName = name;
                myGame = game;
                if (name == "" || game == "") {

                }
                else {
                  socket.emit('newPlayer',{
                      name: name,
                      game: game,
                      destinationID: myID,
                      sourceID: "non"
                  });
                  loginMenu = 0;
                  document.getElementById("content").innerHTML = "";
                  setTimeout(generateGameboard(), 100);
                  setTimeout(generateFigures(), 900);
                  setTimeout(generateDice(), 300);
                }
              }

              var echoNextPlayer = function(){
                socket.emit('nextPlayer',{
                    sourceID: myID,
                    game: myGame,
                    player: turn,
                    playerColor: playerOnTurn
                });
              }

              socket.on('serverNewPlayer',function(data){
                  if (data.game == myGame) {
                    //console.log("my game");
                    if (data.destinationID != myID) {
                      //console.log("not me");
                      if (numberOfPlayers !== "full") {
                        numberOfPlayers++;
                      }
                      console.log(numberOfPlayers);
                      var swap = "";
                      if (numberOfPlayers > 4 || numberOfPlayers == "full") {
                        swap = "spectator";
                      }
                      else {
                        swap = numberOfPlayers;
                      }
                      socket.emit('youArePlayer',{
                          name: data.name,
                          destinationID: data.destinationID,
                          sourceID: myID,
                          game: myGame,
                          imPlayer: iamPlayer,
                          iam: myName,
                          playerNumber: swap
                      });
                    }
                    else {
                      //console.log("its me");
                    }
                  }
                  else {
                    //console.log("not my game");
                  }
              });

              socket.on('serverYouArePlayer',function(data){
                  //console.log(data.msg);
                  if (data.game == myGame) {
                    if (data.sourceID != myID && data.destinationID == myID) {
                      console.log(data.playerNumber);
                      if (data.playerNumber > iamPlayer ) {
                        iamPlayer = data.playerNumber;
                        document.getElementById("numerofp").innerHTML = "Iam player: " + iamPlayer;
                      }
                      else if (data.playerNumber == "spectator") {
                        iamPlayer = "spectator";
                        document.getElementById("numerofp").innerHTML = "Iam: " + iamPlayer;
                      }
                    }
                  }

                  if (data.playerNumber > numberOfPlayers || data.playerNumber == "spectator") {
                    numberOfPlayers = data.playerNumber;
                  }
              });

              socket.on('serverPlayerOnTurn',function(data){
                  if (data.game == myGame) {

                  }
              });

              socket.on('serverWhatIsYourGame',function(data){

              });
              socket.on('serverActiveGames',function(data){
                  if (loginMenu == 0) {

                  }
              });
            </script>
</body>
</html>
